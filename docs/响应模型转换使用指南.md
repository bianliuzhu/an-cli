# å“åº”æ¨¡å‹è½¬æ¢ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

å“åº”æ¨¡å‹è½¬æ¢åŠŸèƒ½å…è®¸ä½ åœ¨ç”Ÿæˆ TypeScript ç±»å‹æ—¶ï¼Œå¯¹ Swagger/OpenAPI çš„å“åº”ç±»å‹è¿›è¡Œè‡ªåŠ¨è½¬æ¢ã€‚æ”¯æŒä¸‰ç§è½¬æ¢æ¨¡å¼ï¼š

1. **unwrapï¼ˆå‰”é™¤å“åº”æ¨¡å‹ï¼‰**ï¼šæå–å“åº”åŒ…è£…å™¨ä¸­çš„ data å­—æ®µ
2. **wrapï¼ˆæ·»åŠ å“åº”æ¨¡å‹ï¼‰**ï¼šä¸ºåŸå§‹å“åº”æ·»åŠ ç»Ÿä¸€çš„åŒ…è£…ç»“æ„
3. **replaceï¼ˆæ›¿æ¢å“åº”æ¨¡å‹ï¼‰**ï¼šä½¿ç”¨è‡ªå®šä¹‰ç±»å‹æ›¿æ¢å“åº”

---

## é…ç½®ä½ç½®

åœ¨ `an.config.json` æ–‡ä»¶çš„ `swaggerConfig` ä¸­æ·»åŠ  `responseModelTransform` é…ç½®ï¼š

```json
{
  "swaggerConfig": [
    {
      "url": "./data/api.json",
      "apiListFileName": "api.ts",
      "responseModelTransform": {
        // é…ç½®é¡¹
      }
    }
  ]
}
```

---

## åœºæ™¯ä¸€ï¼šä¸ºæ²¡æœ‰å“åº”æ¨¡å‹çš„æ¥å£æ·»åŠ å“åº”æ¨¡å‹ï¼ˆwrapï¼‰

### é€‚ç”¨åœºæ™¯

å½“ Swagger å®šä¹‰ä¸­ç›´æ¥è¿”å›æ•°æ®å¯¹è±¡ï¼Œä½†å®é™… API å“åº”åŒ…å«ç»Ÿä¸€çš„åŒ…è£…ç»“æ„æ—¶ä½¿ç”¨ã€‚

### é—®é¢˜ç¤ºä¾‹

**Swagger å®šä¹‰ï¼š**
```json
{
  "paths": {
    "/api/user/current": {
      "get": {
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UsersEntityDto"
                }
              }
            }
          }
        }
      }
    }
  }
}
```

**ç”Ÿæˆçš„ç±»å‹ï¼ˆæ— å“åº”æ¨¡å‹ï¼‰ï¼š**
```typescript
declare namespace ApiUserCurrent_GET {
  type Response = import('../models/users-entity-dto').UsersEntityDto
}
```

**å®é™… API å“åº”ï¼š**
```json
{
  "success": true,
  "code": 0,
  "message": "success",
  "data": {
    "uid": "user123",
    "username": "å¼ ä¸‰",
    "email": "zhangsan@example.com"
  }
}
```

### è§£å†³æ–¹æ¡ˆ

åœ¨é…ç½®ä¸­æ·»åŠ  `wrap` ç±»å‹çš„å“åº”æ¨¡å‹è½¬æ¢ï¼š

```json
{
  "swaggerConfig": [
    {
      "url": "./data/df.json",
      "apiListFileName": "df.ts",
      "responseModelTransform": {
        "type": "wrap",
        "dataField": "data",
        "wrapperFields": {
          "success": "boolean",
          "code": "number",
          "message": "string",
          "data": "T"
        }
      }
    }
  ]
}
```

### é…ç½®è¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `type` | `"wrap"` | æ˜¯ | è½¬æ¢ç±»å‹ï¼Œå›ºå®šä¸º `"wrap"` |
| `dataField` | `string` | å¦ | åŸå§‹æ•°æ®æ”¾ç½®çš„å­—æ®µåï¼Œé»˜è®¤ä¸º `"data"` |
| `wrapperFields` | `Record<string, string>` | æ˜¯ | åŒ…è£…å™¨çš„å­—æ®µå®šä¹‰ï¼Œkey ä¸ºå­—æ®µåï¼Œvalue ä¸ºå­—æ®µç±»å‹ |

### è½¬æ¢åçš„ç±»å‹

```typescript
declare namespace ApiUserCurrent_GET {
  interface Response {
    success?: boolean;
    code?: number;
    message?: string;
    data?: import('../models/users-entity-dto').UsersEntityDto;
  }
}
```

### ä½¿ç”¨ç¤ºä¾‹

```typescript
import { apiUserCurrent_GET } from './api/df';

const response = await apiUserCurrent_GET();
// response ç±»å‹ä¸ºï¼š
// {
//   success?: boolean;
//   code?: number;
//   message?: string;
//   data?: UsersEntityDto;
// }

if (response.success && response.data) {
  console.log(response.data.username);
}
```

---

## åœºæ™¯äºŒï¼šå‰”é™¤å·²æœ‰çš„å“åº”æ¨¡å‹ï¼ˆunwrapï¼‰

### é€‚ç”¨åœºæ™¯

å½“ Swagger å®šä¹‰åŒ…å«å“åº”åŒ…è£…å™¨ï¼Œä½†ä½ æƒ³ç›´æ¥ä½¿ç”¨å†…éƒ¨æ•°æ®ç±»å‹æ—¶ä½¿ç”¨ã€‚

### é—®é¢˜ç¤ºä¾‹

**Swagger å®šä¹‰ï¼š**
```json
{
  "paths": {
    "/op/trade/refund_order/createOrder": {
      "post": {
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ResultMessageBoolean"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ResultMessageBoolean": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "msg": { "type": "string" },
          "code": { "type": "integer" },
          "timestamp": { "type": "integer" },
          "data": { "type": "boolean" }
        }
      }
    }
  }
}
```

**ç”Ÿæˆçš„ç±»å‹ï¼ˆåŒ…å«å“åº”æ¨¡å‹ï¼‰ï¼š**
```typescript
declare namespace OpTradeRefundOrderCreateorder_POST {
  type Body = import('../models/refund-order-create-dto').RefundOrderCreateDTO
  type Response = import('../models/result-message-boolean').ResultMessageBoolean
}
```

**ä½ æƒ³è¦çš„ç±»å‹ï¼ˆåªè¦ data å­—æ®µï¼‰ï¼š**
```typescript
declare namespace OpTradeRefundOrderCreateorder_POST {
  type Body = import('../models/refund-order-create-dto').RefundOrderCreateDTO
  type Response = boolean
}
```

### è§£å†³æ–¹æ¡ˆ

åœ¨é…ç½®ä¸­æ·»åŠ  `unwrap` ç±»å‹çš„å“åº”æ¨¡å‹è½¬æ¢ï¼š

```json
{
  "swaggerConfig": [
    {
      "url": "./data/op.json",
      "apiListFileName": "op.ts",
      "responseModelTransform": {
        "type": "unwrap",
        "dataField": "data"
      }
    }
  ]
}
```

### é…ç½®è¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `type` | `"unwrap"` | æ˜¯ | è½¬æ¢ç±»å‹ï¼Œå›ºå®šä¸º `"unwrap"` |
| `dataField` | `string` | å¦ | è¦æå–çš„å­—æ®µåï¼Œé»˜è®¤ä¸º `"data"` |

### è½¬æ¢åçš„ç±»å‹

```typescript
declare namespace OpTradeRefundOrderCreateorder_POST {
  type Body = import('../models/refund-order-create-dto').RefundOrderCreateDTO
  type Response = boolean
}
```

### æ›´å¤šç¤ºä¾‹

#### ç¤ºä¾‹ 1: æå–åˆ†é¡µæ•°æ®

**åŸå§‹ç±»å‹ï¼š**
```typescript
type Response = import('../models/result-message-ipage-refund-order-query-vo').ResultMessageIPageRefundOrderQueryVO
```

**é…ç½®ï¼š**
```json
{
  "responseModelTransform": {
    "type": "unwrap",
    "dataField": "data"
  }
}
```

**è½¬æ¢åï¼š**
```typescript
type Response = import('../models/ipage-refund-order-query-vo').IPageRefundOrderQueryVO
```

#### ç¤ºä¾‹ 2: æå–è‡ªå®šä¹‰å­—æ®µ

å¦‚æœå“åº”æ¨¡å‹çš„æ•°æ®å­—æ®µåä¸æ˜¯ `data`ï¼Œè€Œæ˜¯ `result`ï¼š

```json
{
  "responseModelTransform": {
    "type": "unwrap",
    "dataField": "result"
  }
}
```

---

## åœºæ™¯ä¸‰ï¼šæ›¿æ¢å“åº”æ¨¡å‹ï¼ˆreplaceï¼‰

### é€‚ç”¨åœºæ™¯

å½“ä½ æƒ³ç”¨è‡ªå®šä¹‰çš„æ³›å‹ç±»å‹æˆ–å…¶ä»–ç±»å‹å®Œå…¨æ›¿æ¢åŸæœ‰å“åº”ç±»å‹æ—¶ä½¿ç”¨ã€‚

### é—®é¢˜ç¤ºä¾‹

**åŸå§‹å“åº”ç±»å‹ï¼š**
```typescript
type Response = import('../models/activity-response-dto-ilist-service-response').ActivityResponseDTOIListServiceResponse
```

**ä½ æƒ³è¦çš„ç±»å‹ï¼š**
```typescript
type Response = ApiResponse<ActivityData>
```

### è§£å†³æ–¹æ¡ˆ

åœ¨é…ç½®ä¸­æ·»åŠ  `replace` ç±»å‹çš„å“åº”æ¨¡å‹è½¬æ¢ï¼š

```json
{
  "swaggerConfig": [
    {
      "url": "./data/sau.json",
      "apiListFileName": "sau.ts",
      "responseModelTransform": {
        "type": "replace",
        "wrapperType": "ApiResponse<T>"
      }
    }
  ]
}
```

### é…ç½®è¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `type` | `"replace"` | æ˜¯ | è½¬æ¢ç±»å‹ï¼Œå›ºå®šä¸º `"replace"` |
| `wrapperType` | `string` | æ˜¯ | æ›¿æ¢åçš„ç±»å‹å­—ç¬¦ä¸² |

### è½¬æ¢åçš„ç±»å‹

```typescript
declare namespace ApiActivityServicevisitServiceVisitId_GET {
  type Response = ApiResponse<T>
}
```

### æ³¨æ„äº‹é¡¹

- `wrapperType` å¯ä»¥æ˜¯ä»»ä½• TypeScript ç±»å‹å­—ç¬¦ä¸²
- å¦‚æœä½¿ç”¨æ³›å‹ç±»å‹ï¼ˆå¦‚ `ApiResponse<T>`ï¼‰ï¼Œéœ€è¦ç¡®ä¿è¯¥ç±»å‹åœ¨é¡¹ç›®ä¸­å·²å®šä¹‰
- é€šå¸¸éœ€è¦åœ¨ `api-type.d.ts` ä¸­å®šä¹‰è‡ªå®šä¹‰ç±»å‹ï¼š

```typescript
// apps/api/api-type.d.ts
type ApiResponse<T> = {
  code: number;
  message: string;
  data: T;
  success: boolean;
};
```

---

## å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "saveTypeFolderPath": "apps/types",
  "saveApiListFolderPath": "apps/api/",
  "saveEnumFolderPath": "apps/enums",
  "importEnumPath": "../../enums",
  "requestMethodsImportPath": "./fetch",
  "formatting": {
    "indentation": "\t",
    "lineEnding": "\n"
  },
  "enmuConfig": {
    "erasableSyntaxOnly": false,
    "varnames": "enum-varnames",
    "comment": "enum-descriptions"
  },
  "swaggerConfig": [
    {
      "url": "./data/op.json",
      "apiListFileName": "op.ts",
      "publicPrefix": "/forward",
      "dataLevel": "serve",
      "parameterSeparator": "_",
      "responseModelTransform": {
        "type": "unwrap",
        "dataField": "data"
      }
    },
    {
      "url": "./data/df.json",
      "apiListFileName": "df.ts",
      "publicPrefix": "/api",
      "dataLevel": "serve",
      "parameterSeparator": "_",
      "responseModelTransform": {
        "type": "wrap",
        "dataField": "data",
        "wrapperFields": {
          "success": "boolean",
          "code": "number",
          "message": "string",
          "data": "T"
        }
      }
    },
    {
      "url": "./data/sau.json",
      "apiListFileName": "sau.ts",
      "publicPrefix": "/api",
      "dataLevel": "serve",
      "parameterSeparator": "_",
      "responseModelTransform": {
        "type": "replace",
        "wrapperType": "CustomApiResponse"
      }
    }
  ]
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å¯ä»¥å¯¹ä¸åŒçš„æ¥å£ä½¿ç”¨ä¸åŒçš„è½¬æ¢å—ï¼Ÿ

A: ç›®å‰è½¬æ¢é…ç½®æ˜¯æŒ‰ Swagger æœåŠ¡ç²’åº¦é…ç½®çš„ã€‚å¦‚æœéœ€è¦å¯¹åŒä¸€ä¸ª Swagger æ–‡ä»¶ä¸­çš„ä¸åŒæ¥å£ä½¿ç”¨ä¸åŒè½¬æ¢ï¼Œå¯ä»¥ï¼š
1. å°† Swagger æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶
2. ä½¿ç”¨ `includeInterface` å’Œ `excludeInterface` é…ç½®ä¸ºä¸åŒæ¥å£ç»„é…ç½®ä¸åŒçš„ Swagger æœåŠ¡

### Q2: unwrap è½¬æ¢å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: unwrap è½¬æ¢è¦æ±‚ï¼š
1. å“åº”ç±»å‹å¿…é¡»æ˜¯ `$ref` å¼•ç”¨ç±»å‹ï¼ˆä¸èƒ½æ˜¯å†…è”å¯¹è±¡ï¼‰
2. å¼•ç”¨çš„ schema å¿…é¡»åŒ…å«æŒ‡å®šçš„ `dataField`ï¼ˆé»˜è®¤ä¸º `data`ï¼‰
3. å¦‚æœè½¬æ¢å¤±è´¥ï¼Œä¼šä¿æŒåŸå§‹ç±»å‹ä¸å˜ï¼Œå¹¶åœ¨æ—¥å¿—ä¸­è¾“å‡ºè­¦å‘Šä¿¡æ¯

### Q3: wrap è½¬æ¢æ—¶åŸå§‹ç±»å‹æ˜¯å¯¹è±¡æ€ä¹ˆåŠï¼Ÿ

A: å¦‚æœåŸå§‹å“åº”ç±»å‹æ˜¯å†…è”å¯¹è±¡ï¼ˆæœ‰å¤šä¸ªå­—æ®µï¼‰ï¼Œwrap è½¬æ¢ä¼šå°†æ•´ä¸ªå¯¹è±¡ä½œä¸º `data` å­—æ®µçš„å€¼ã€‚

### Q4: ä¸é…ç½® responseModelTransform ä¼šæ€æ ·ï¼Ÿ

A: å¦‚æœä¸é…ç½®ï¼Œç”Ÿæˆçš„ç±»å‹å°†å®Œå…¨æŒ‰ç…§ Swagger å®šä¹‰ç”Ÿæˆï¼Œä¸åšä»»ä½•è½¬æ¢ã€‚

### Q5: å¯ä»¥å…¨å±€é…ç½®é»˜è®¤è½¬æ¢å—ï¼Ÿ

A: å¯ä»¥åœ¨æ ¹çº§åˆ«çš„ `swaggerConfig` å¤–å±‚é…ç½® `responseModelTransform`ï¼Œæ‰€æœ‰æœªé…ç½®çš„æœåŠ¡ä¼šç»§æ‰¿è¯¥é…ç½®ï¼š

```json
{
  "responseModelTransform": {
    "type": "unwrap",
    "dataField": "data"
  },
  "swaggerConfig": [
    {
      "url": "./data/op.json",
      "apiListFileName": "op.ts"
      // ä¼šä½¿ç”¨å…¨å±€é…ç½®
    },
    {
      "url": "./data/df.json",
      "apiListFileName": "df.ts",
      "responseModelTransform": {
        "type": "wrap",
        "dataField": "data",
        "wrapperFields": {
          "success": "boolean",
          "data": "T"
        }
      }
      // ä¼šè¦†ç›–å…¨å±€é…ç½®
    }
  ]
}
```

---

## æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€å“åº”æ¨¡å‹è§„èŒƒ

å¦‚æœä½ çš„åç«¯ API ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼Œå»ºè®®ï¼š
- ä¸ºæ²¡æœ‰å“åº”æ¨¡å‹çš„ Swagger ä½¿ç”¨ `wrap` è½¬æ¢
- ä¸ºå·²æœ‰ä¸åŒå“åº”æ¨¡å‹çš„ Swagger ä½¿ç”¨ `unwrap` è½¬æ¢
- æœ€ç»ˆä¿æŒæ‰€æœ‰ API çš„å“åº”ç±»å‹ä¸€è‡´

### 2. é…åˆ api-type.d.ts ä½¿ç”¨

åœ¨ `apps/api/api-type.d.ts` ä¸­å®šä¹‰ç»Ÿä¸€çš„å“åº”ç±»å‹ï¼š

```typescript
type ResponseModel<T> = {
  code: number;
  message: string;
  data: T;
  success: boolean;
};
```

ç„¶ååœ¨ä»£ç ä¸­ç»Ÿä¸€ä½¿ç”¨ï¼š

```typescript
export const apiUserCurrent_GET = (params?: IRequestFnParams) => 
  GET<ResponseModel<UsersEntityDto>>(`/api/user/current`, {...params}, 'serve');
```

### 3. æ¸è¿›å¼è¿ç§»

å¦‚æœé¡¹ç›®å·²ç»åœ¨ä½¿ç”¨æ—§çš„ç±»å‹å®šä¹‰ï¼Œå»ºè®®ï¼š
1. å…ˆä¸ºæ–°çš„ Swagger æœåŠ¡é…ç½®å“åº”æ¨¡å‹è½¬æ¢
2. é€æ­¥è¿ç§»æ—§çš„æœåŠ¡
3. ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·ç¡®ä¿å˜æ›´å¯å›æ»š

---

## æŠ€æœ¯ç»†èŠ‚

### è½¬æ¢æ—¶æœº

å“åº”æ¨¡å‹è½¬æ¢åœ¨ç±»å‹ç”Ÿæˆé˜¶æ®µè¿›è¡Œï¼Œå…·ä½“æµç¨‹ï¼š

1. è§£æ Swagger/OpenAPI æ–‡æ¡£
2. è§£æå“åº”ç±»å‹ï¼ˆResponse Typeï¼‰
3. åº”ç”¨ `responseModelTransform` é…ç½®
4. ç”Ÿæˆæœ€ç»ˆçš„ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶

### æ”¯æŒçš„å“åº”ç±»å‹

- âœ… `$ref` å¼•ç”¨ç±»å‹ï¼ˆå¦‚ `#/components/schemas/ResultMessageBoolean`ï¼‰
- âœ… å†…è”å¯¹è±¡ç±»å‹ï¼ˆå¦‚ `{ type: 'object', properties: {...} }`ï¼‰
- âœ… åŸºç¡€ç±»å‹ï¼ˆå¦‚ `string`, `number`, `boolean`ï¼‰
- âœ… æ•°ç»„ç±»å‹ï¼ˆå¦‚ `Array<T>`ï¼‰
- âœ… è”åˆç±»å‹ï¼ˆå¦‚ `string | number`ï¼‰

### ä¸æ”¯æŒçš„åœºæ™¯

- âŒ å†…è”å¯¹è±¡ç±»å‹çš„ unwrap è½¬æ¢ï¼ˆå› ä¸ºæ— æ³•ä» schema ä¸­æå–å­—æ®µï¼‰
- âŒ åŠ¨æ€å­—æ®µæå–ï¼ˆå¿…é¡»æ˜ç¡®æŒ‡å®š `dataField`ï¼‰

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-23)
- âœ¨ æ–°å¢å“åº”æ¨¡å‹è½¬æ¢åŠŸèƒ½
- âœ¨ æ”¯æŒ unwrapï¼ˆå‰”é™¤ï¼‰ã€wrapï¼ˆæ·»åŠ ï¼‰ã€replaceï¼ˆæ›¿æ¢ï¼‰ä¸‰ç§è½¬æ¢æ¨¡å¼
- âœ¨ æ”¯æŒå…¨å±€å’ŒæœåŠ¡çº§åˆ«çš„é…ç½®
- ğŸ“ æ·»åŠ è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

---

## ç›¸å…³é“¾æ¥

- [an-cli GitHub](https://github.com/your-repo/an-cli)
- [é—®é¢˜åé¦ˆ](https://github.com/your-repo/an-cli/issues)
- [é…ç½®ç¤ºä¾‹](../an.config.example.json)
